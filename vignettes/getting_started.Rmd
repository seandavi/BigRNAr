---
title: "Using BigRNA"
author:
- name: Sean Davis, MD, PhD
  affiliation: Center for Cancer Research, National Cancer Institute, National Institutes of Health, Bethesda, MD
- name: Second Author
  affiliation: Second Author's Affiliation
  email: corresponding@author.com
package: packageName
output:
  BiocStyle::html_document
abstract: |
  Description of your vignette
vignette: |
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Getting started

```{r eval=FALSE}
BiocManager::install("seandavi/BigRNA")
```


## Create BigRNA connection object

```{r}
library(BigRNA)
bigrna = new("BigRNAConnection")
bigrna
```

# Use Cases

## Full text search of studies

```{r}
studyFullTextSearch = '
query studyFullTextSearch (
  $match: String!=""
  $cursor: Cursor=null
) {
  allStudies(
    filter: {textsearchableIndexCol: {matches: $match}}
    after: $cursor
  ) {
    edges {
      node {
        accession
        bioproject
        gse
        abstract
        alias
        attributes
        brokerName
        centerName
        description
        identifiers
        studyType
        title
        xrefs
        status
        updated
        published
        received
        visibility
        replacedBy
        metadataByExptStudyAccession {
          nodes {
            sampAccession
            exptAccession
            sampTitle
            exptLibraryStrategy
            exptLibrarySelection
          }
          totalCount
        }
      }
    }
    pageInfo {
      hasNextPage
      endCursor
    }
    totalCount
  }
}
'

x=gqlQuery(bigrna, studyFullTextSearch, 
           variables=list(match='colon & cancer'), 
           handler=dataframe_handler)
names(x)
```

```{r}
library(DT)
print(datatable(x$edges))
```


## Getting data

```{r fileslisting}
fileListQuery = '
{
  allBigrnaFiles(filter: {filename: {equalTo: "quant.genes.sf.gz"}}) {
    edges {
      node {
        key
        accession
        filename
      }
    }
    pageInfo {
      hasNextPage
      endCursor
    }
  }
}
'
x=gqlQuery(bigrna, fileListQuery, 
           variables=list(match='colon & cancer', cursor=NULL), 
           handler=dataframe_handler)
maxN = 1000
df = x$edges
while(x$pageInfo$hasNextPage & nrow(df)<maxN ) {
  x=gqlQuery(bigrna, fileListQuery, 
           variables=list(match='colon & cancer', cursor=x$pageInfo$endCursor), 
           handler=dataframe_handler)
  df = dplyr::bind_rows(df, x$edges)
}
```


## Download



```{r}
fnames = sapply(df$node.key[1:100], function(path) {
  path = sub('^/','',path)
  datafile(bigrna, path)
})
```

```{r}
head(fnames)
```

* `r Biocpkg("IRanges")`, for _Bioconductor_ software, annotation and experiment data packages,
* `r CRANpkg("data.table")`, for _R_ packages available on CRAN,
* `r Githubpkg("rstudio/rmarkdown")`, for _R_ packages available on GitHub,
* `r Rpackage("MyPkg")`, for _R_ packages that are _not_ available on _Bioconductor_, CRAN or GitHub.


# Figures

Assign captions to figures in the code chunk option `fig.cap` to automatically number them, and to be able to reference them, see Figure \@ref(fig:plot). The figure label is generated from the code chunk label by prefixing it with `fig:`.

```{r plot, fig.cap="Regular figure. The first sentence of the figure caption is automatically emphasized to serve as figure title.", echo=FALSE}
plot(cars)
```

Small and wide figures can be specified by `fig.small` and `fig.wide` code chunk options.

```{r small, fig.cap="Small figure. A plot produced by a code chunk with option `fig.small = TRUE`.", fig.small=TRUE, echo=FALSE}
plot(cars)
```

```{r wide, fig.cap="Wide figure. A plot produced by a code chunk with option `fig.wide = TRUE`.", fig.wide=TRUE, echo=FALSE}
plot(cars)
```


# Equations

To number and reference equations, put them in equation environments and assign labels to them, see Equation \@ref(eq:binom).

\begin{equation}
  f\left(k\right) = \binom{n}{k} p^k\left(1-p\right)^{n-k}
  (\#eq:binom)
\end{equation}


# Tables

Like figures, tables with captions will also be numbered and can be referenced, see Table \@ref(tab:table).

Fruit   | Price
------- | -----
bananas | 1.2
apples  | 1.0
oranges | 2.5

: (\#tab:table) A simple table. With caption.


# Cross-references

Apart from referencing figures (Section \@ref(figures)), tables (Section \@ref(tables)), and equations (Section \@ref(equations)), you can also use the same syntax to refer to sections by their default labels generated by pandoc.


# Side notes

Footnotes are displayed as side notes on the right margin^[this is a side note entered as a footnote], which has the advantage that they appear close to the place where they are defined.


# Session info {.unnumbered}

```{r sessionInfo, echo=FALSE}
sessionInfo()
```
